# ほか弁当サイト運用マニュアル

## 目次

1. [メニューの管理](#1-メニューの管理)
2. [おすすめ設定](#2-おすすめ設定)
3. [画像の管理](#3-画像の管理)
4. [公開反映の仕組み](#4-公開反映の仕組み)
5. [よくある質問](#5-よくある質問)

---

## 1. メニューの管理

### 1.1 新しいメニューの追加

**手順：**
1. microCMS管理画面にログイン
2. 「コンテンツ（メニュー商品）」を選択
3. 「追加」ボタンをクリック
4. 必要項目を入力：
   - **商品名**: 「特製唐揚げ弁当」など、わかりやすい名前
   - **URL用識別子**: 半角英数字とハイフンのみ（例：`karaage-bento`）
   - **価格**: 税込価格を数字のみ入力（例：850）
   - **商品説明**: お客様向けの詳細説明
   - **商品画像**: 推奨サイズの画像をアップロード
   - **カテゴリ**: 該当するカテゴリを選択
   - **タグ**: 「人気」「限定」などを設定
   - **販売状況**: 在庫がある場合はONに設定
5. 「下書き保存」または「公開」をクリック

**注意点：**
- URL用識別子は一意である必要があります
- 公開後の識別子変更はURLが変わるため推奨しません

### 1.2 メニューの編集

**手順：**
1. 「コンテンツ（メニュー商品）」一覧から対象商品を選択
2. 内容を編集
3. 「更新」をクリック

**よく編集する項目：**
- **価格**: 価格改定時
- **販売状況**: 売り切れ・再入荷時
- **商品説明**: 内容変更時
- **タグ**: キャンペーン情報の追加・削除時

### 1.3 メニューの削除

**手順：**
1. 削除したい商品を選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「削除」を再度クリック

**注意点：**
- 削除すると商品詳細ページが404エラーになります
- 一時的に非表示にしたい場合は「販売状況」をOFFにしてください

### 1.4 カテゴリの管理

**新しいカテゴリの追加：**
1. 「コンテンツ（メニューカテゴリ）」を選択
2. 「追加」ボタンをクリック
3. 必要項目を入力：
   - **カテゴリ名**: 「弁当」「定食」など
   - **URL用識別子**: 半角英数字とハイフン（例：`bento`）
   - **表示順序**: 小さい数字ほど前に表示（1, 2, 3...）

---

## 2. おすすめ設定

### 2.1 おすすめ商品の基本設定

**手順：**
1. 対象商品の編集画面を開く
2. **おすすめ設定**をONにする
3. 必要に応じて期間を設定
4. 「更新」をクリック

### 2.2 期間指定おすすめの設定

**日時の考え方（JST基準）：**
- **おすすめ開始日時**: 日本標準時（JST）で設定
- **おすすめ終了日時**: 日本標準時（JST）で設定
- システムが自動的に現在のJST時刻と比較して表示判定

**設定例：**
```
おすすめ開始日時: 2024-07-28 09:00（月曜日の開店時間）
おすすめ終了日時: 2024-08-04 21:00（日曜日の閉店時間）
```

**表示優先順位：**
1. **期間指定あり + 現在時刻が範囲内** → 最優先で表示
2. **期間指定なし + おすすめON** → フォールバック表示
3. **期間外または未設定** → 表示されない

### 2.3 おすすめ設定のベストプラクティス

**推奨設定パターン：**
- **常時おすすめ**: 期間設定なし、おすすめONのみ
- **期間限定キャンペーン**: 開始・終了日時を具体的に設定
- **曜日限定**: 毎週月曜9:00〜金曜18:00など

**注意点：**
- 期間が重複する商品が多数ある場合、新しい商品順に表示されます
- おすすめ商品は最大10件まで取得されます

---

## 3. 画像の管理

### 3.1 推奨画像仕様

**商品画像:**
- **サイズ**: 横800px × 縦600px（4:3比率）
- **形式**: JPEG または PNG
- **容量**: 500KB以下推奨（最大5MB）
- **解像度**: 72dpi

**画質チェックポイント:**
- 料理の色味が鮮明
- ピントが合っている
- 適切な明るさ
- 背景がシンプル

### 3.2 画像のアップロード手順

**手順：**
1. 商品編集画面の「商品画像」セクション
2. 「画像を選択」をクリック
3. ローカルファイルから画像を選択
4. アップロード完了を確認
5. プレビューで表示を確認

**アップロード後の処理:**
- microCMS側で自動的にWebP形式に変換
- 複数サイズのレスポンシブ画像を生成
- CDN経由で高速配信

### 3.3 画像の差し替え

**手順：**
1. 対象商品の編集画面を開く
2. 現在の画像の「削除」をクリック
3. 新しい画像をアップロード
4. 「更新」をクリック

**注意点：**
- 画像変更後、サイトに反映されるまで最大60秒かかります
- ブラウザキャッシュにより古い画像が表示される場合があります

---

## 4. 公開反映の仕組み

### 4.1 ISR（Incremental Static Regeneration）

**仕組み：**
- サイトは60秒間隔で自動更新されます
- 変更内容は最大60秒後にサイトに反映されます
- 高速表示とリアルタイム更新を両立

**反映タイミング:**
```
microCMS更新 → Webhook送信 → サイト再生成 → 反映完了
     ↓              ↓           ↓          ↓
   即時           数秒以内      10-30秒     完了
```

### 4.2 Webhook設定

**設定済み内容:**
- **URL**: `https://yourdomain.com/api/revalidate?secret=your_secret`
- **トリガー**: コンテンツの公開・更新・削除時
- **対象API**: メニュー商品、メニューカテゴリ、サイト設定

**Webhook送信時の動作:**
1. microCMSからWebhookが送信される
2. サイトが更新されたコンテンツを検知
3. 関連ページのキャッシュを無効化
4. 次回アクセス時に新しいコンテンツを表示

### 4.3 手動での即座反映

**緊急時の手動更新:**
```bash
# APIエンドポイントに直接アクセス
POST https://yourdomain.com/api/revalidate?secret=your_secret
```

**ブラウザでの確認:**
- `Ctrl + F5`（強制リロード）で最新内容を確認
- スーパーリロードでキャッシュを回避

---

## 5. よくある質問

### 5.1 コンテンツが反映されない

**Q: 商品を更新したのにサイトに反映されません**

**A: 以下を順番に確認してください：**

1. **公開状態の確認**
   - 商品が「公開」状態になっているか確認
   - 「下書き」状態では反映されません

2. **時間の確認**
   - 更新から60秒以上経過したか確認
   - Webhookが正常に送信されているか確認

3. **ブラウザキャッシュの確認**
   - `Ctrl + F5`で強制リロード
   - 別のブラウザで確認

4. **Webhook状態の確認**
   - microCMS管理画面でWebhook送信履歴を確認
   - エラーが発生していないか確認

### 5.2 画像が表示されない

**Q: 画像をアップロードしたのに表示されません**

**A: 以下を確認してください：**

1. **画像形式の確認**
   - JPEG, PNG形式のみ対応
   - WebP, GIF等は正常に表示されない場合があります

2. **ファイルサイズの確認**
   - 5MB以下になっているか確認
   - 大きすぎるファイルはアップロードに失敗します

3. **アップロード完了の確認**
   - microCMS画面でプレビューが表示されているか確認
   - アップロード中に画面を閉じていないか確認

4. **権限の確認**
   - 画像ファイルの管理権限があるか確認

### 5.3 おすすめ商品が表示されない

**Q: おすすめ設定をONにしたのに表示されません**

**A: 以下を確認してください：**

1. **期間設定の確認**
   - 現在日時が設定期間内にあるか確認（JST基準）
   - 終了日時が過去になっていないか確認

2. **販売状況の確認**
   - 商品の「販売状況」がONになっているか確認
   - 売り切れ商品は一部表示から除外されます

3. **他のおすすめ商品との優先度**
   - 期間指定がある商品が優先表示されます
   - 更新日時が新しい商品が優先されます

### 5.4 カテゴリページでエラーが発生

**Q: 特定のカテゴリページが404エラーになります**

**A: 以下を確認してください：**

1. **カテゴリの存在確認**
   - 該当カテゴリが削除されていないか確認
   - カテゴリの「公開」状態を確認

2. **URL識別子の確認**
   - カテゴリのURL識別子が正しく設定されているか確認
   - 識別子の変更により既存URLが無効になっていないか確認

3. **商品の関連付け確認**
   - カテゴリに商品が正しく関連付けられているか確認

### 5.5 パフォーマンスの問題

**Q: サイトの表示が遅くなりました**

**A: 以下を確認してください：**

1. **画像サイズの最適化**
   - 大きすぎる画像ファイルがないか確認
   - 推奨サイズ（500KB以下）に最適化

2. **商品数の確認**
   - 大量の商品が一度に表示されていないか確認
   - ページネーション機能を活用

3. **ブラウザの確認**
   - 古いブラウザを使用していないか確認
   - JavaScript・CSSが正常に読み込まれているか確認

### 5.6 問い合わせ先

**技術的な問題:**
- システム管理者にお問い合わせください
- エラーメッセージのスクリーンショットを添付してください

**コンテンツに関する問題:**
- サイト運営担当者にお問い合わせください
- 発生日時と具体的な操作内容をお知らせください

---

## 付録

### A. microCMS管理画面へのアクセス

**URL**: `https://your-service.microcms.io/`
**ログイン情報**: 管理者から提供されたID・パスワード

### B. 緊急時の連絡先

**システム障害**: [システム管理者の連絡先]
**コンテンツ問題**: [サイト運営担当者の連絡先]
**営業時間**: 平日 9:00-18:00

### C. 関連ドキュメント

- microCMS公式ドキュメント: https://document.microcms.io/
- Next.js ISRドキュメント: https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration

---

*最終更新日: 2024年7月28日*  
*バージョン: 1.0*